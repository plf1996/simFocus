# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

**simFocus** 是一个 AI 虚拟焦点小组平台，通过模拟多个不同背景、思维风格的虚拟角色进行实时讨论，帮助用户快速获取多角度观点、深度洞察和创意启发。

### 核心产品定位

- **多视角碰撞**：一次讨论获取 3-7 个不同角色的观点
- **实时观摩体验**：观看观点形成、碰撞、演变的全过程
- **智能角色系统**：支持自定义角色或 AI 自动生成最适合议题的讨论者
- **隐私与可控**：用户自备 API 密钥，数据本地化存储

### 目标用户

1. 产品经理 - 快速验证产品想法的可行性
2. 独立研究者/学术工作者 - 模拟多专家视角的深度思辨
3. 创业创始人 - 商业模式压力测试、决策风险分析

---

## 技术架构

项目处于初始化阶段，尚未实现代码。根据 PRD 文档，系统需要以下核心模块：

### 核心模块

1. **用户系统 (User System)**
   - 邮箱注册/登录、第三方登录 (Google/GitHub)
   - API 密钥管理 (OpenAI、Anthropic、本地模型)

2. **议题管理 (Topic Management)**
   - 创建/编辑讨论议题
   - 议题模板库
   - 历史议题管理

3. **角色系统 (Character System)**
   - 自定义角色创建 (多维度配置)
   - 智能角色推荐
   - 预置角色库 (100+ 优质角色模板)

4. **讨论引擎 (Discussion Engine)**
   - 多角色讨论驱动 (10-20 轮)
   - 多种讨论模式 (自由讨论、结构化辩论、创意发散、共识达成)
   - 实时观摩交互 (WebSocket)
   - 讨论过程控制 (暂停/继续/加速/插入问题)

5. **报告生成 (Report Generation)**
   - 讨论总结报告 (观点汇总、共识结论、争议焦点、洞察建议)
   - 报告可视化 (观点分布图、争议热力图、关键词云图)
   - 报告导出 (PDF/Markdown/JSON)

6. **API 管理 (API Management)**
   - 支持多个大模型提供商 (OpenAI、Anthropic、兼容 OpenAI 格式)
   - API 使用监控和成本统计

### 推荐技术栈 (待确定)

- **前端**: React/Vue.js + WebSocket 实时通信
- **后端**: Node.js/Python/FastAPI
- **数据库**: PostgreSQL (关系数据) + 向量数据库 (角色历史记忆)
- **通信**: WebSocket (实时观摩)
- **部署**: Docker 容器化

---

## 关键业务概念

### 讨论阶段控制

讨论分为四个阶段，需要通过 Prompt Engineering 精心设计：

1. **开场阶段** (1-2轮): 角色自我介绍，阐述初步立场
2. **展开阶段** (3-8轮): 角色之间相互回应，深入论证
3. **辩论阶段** (2-5轮): 针对分歧点展开交锋
4. **收尾阶段** (1-2轮): 总结观点，尝试达成共识

### 讨论模式

- **自由讨论模式**: 角色自由发言，系统维护发言平衡
- **结构化辩论模式**: 正方/反方/中立方，系统指定发言角色
- **创意发散模式**: 基于 "yes, and" 原则，禁止直接否定
- **共识达成模式**: 寻找共同点，主动妥协和整合观点

### 角色配置维度

- 基本信息: 姓名、年龄、性别、职业/身份
- 性格特征: 开放性、严谨性、批判性、乐观度 (1-10分)
- 知识背景: 专业领域、经验年限、代表性观点
- 讨论立场: 支持/反对/中立/批判性探索
- 表达风格: 正式/口语化/技术性/故事化
- 行为模式: 主动发言/被动响应/平衡型

---

## 功能优先级

### MVP (P0) 必须包含

- 用户注册/登录
- API 密钥配置
- 创建议题
- 自定义角色创建 (基础版)
- 预置角色库 (50 个角色)
- 多角色自由讨论模式
- 实时观摩界面
- 讨论总结报告 (基础版)
- 历史记录查询

### P1 增强功能

- 智能角色推荐
- 高级讨论控制 (加速播放、插入引导问题)
- 议题模板库
- 报告导出 (PDF/Markdown)
- 角色库扩展至 100+
- 分享链接功能

### P2 高级功能

- 讨论质量评分
- 团队协作
- 多种讨论模式
- 角色进化学习

---

## 安全与隐私要求

- API 密钥必须加密存储 (AES-256)
- 传输过程使用 HTTPS 加密
- 用户讨论内容默认私密，不用于训练 AI
- 支持用户导出和删除个人数据
- 遵守 GDPR、CCPA 等隐私法规

---

## 性能要求

- 响应时间 < 2秒 (不包含大模型 API 调用)
- 首条消息延迟 < 10秒
- 消息生成速度 5-10秒/条
- 报告生成时间 < 10秒
- API 调用成功率 > 99% (包含重试)

---

## 浏览器支持

- Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 桌面端为主 (1920x1080 及以上)
- 平板/移动端响应式设计

---

## 文档说明

- 完整的产品需求文档位于 `docs/PRD.md`
- PRD 包含详细的用户故事、功能规格、竞品分析、风险与依赖等信息

## 其他注意事项
- 前端框架使用vue3
- 后端框架使用fastapi
- 代码中命名全部使用英文，注释也使用英文，git提交信息也适用英文
- git提交信息不能包含任何AI的痕迹，且在提交代码时需由我确认